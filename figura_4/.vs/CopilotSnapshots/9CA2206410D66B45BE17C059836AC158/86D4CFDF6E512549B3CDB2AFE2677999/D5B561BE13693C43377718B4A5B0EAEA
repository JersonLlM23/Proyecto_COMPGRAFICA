using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace figura_4
{
    public partial class Form1 : Form
    {
        private Bitmap canvas;
        private float anguloRotacion = 0f;
        private int pasoActual = 0;
        private float radioActual = 100f;
        private float escalaActual = 1.0f;

        public Form1()
        {
            InitializeComponent();
            canvas = new Bitmap(picCanvas.Width, picCanvas.Height);
        }

        private void btnCalcular_Click(object sender, EventArgs e)
        {
            if (float.TryParse(txtTamano.Text, out float radioInput))
            {
                radioActual = radioInput;
                escalaActual = trackBarTamano.Value / 100f;
                pasoActual = 5; // Mostrar todo
                DibujarFigura();
            }
            else
            {
                MessageBox.Show("Por favor ingresa un valor numérico válido.", "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }

        private void btnResetear_Click(object sender, EventArgs e)
        {
            anguloRotacion = 0f;
            pasoActual = 0;
            escalaActual = 1.0f;
            trackBarTamano.Value = 100;
            txtTamano.Text = "100";
            radioActual = 100f;
            
            canvas = new Bitmap(picCanvas.Width, picCanvas.Height);
            picCanvas.Image = canvas;
            picCanvas.Refresh();
        }

        private void btnRotarAntihorario_Click(object sender, EventArgs e)
        {
            anguloRotacion -= 5f * (float)Math.PI / 180f; // -5 grados a radianes
            DibujarFigura();
        }

        private void btnRotarHorario_Click(object sender, EventArgs e)
        {
            anguloRotacion += 5f * (float)Math.PI / 180f; // +5 grados a radianes
            DibujarFigura();
        }

        private void trackBarTamano_Scroll(object sender, EventArgs e)
        {
            escalaActual = trackBarTamano.Value / 100f;
            DibujarFigura();
        }

        private void btnAnterior_Click(object sender, EventArgs e)
        {
            if (pasoActual > 0)
            {
                pasoActual--;
                DibujarFigura();
            }
        }

        private void btnSiguiente_Click(object sender, EventArgs e)
        {
            if (pasoActual < 5)
            {
                pasoActual++;
                DibujarFigura();
            }
        }

        private void DibujarFigura()
        {
            canvas = new Bitmap(picCanvas.Width, picCanvas.Height);
            Graphics g = Graphics.FromImage(canvas);
            g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;
            g.Clear(Color.White);

            float radio = radioActual * escalaActual;
            float mitad = radio / 2;
            float parte_mitad = mitad / 5;
            float ancho = picCanvas.Width;
            float alto = picCanvas.Height;
            
            float[] verticex_cuadrado2 = new float[6];
            float[] verticey_cuadrado2 = new float[6];
            float[,,] puntasx_hexa = new float[6, 6, 5];
            float[,,] puntasy_hexa = new float[6, 6, 5];
            float x = ancho / 2;
            float y = alto / 2;
            float angulo1 = (float)Math.PI + anguloRotacion;

            // Calcular centros de hexágonos
            for (int i = 0; i < 6; i++)
            {
                verticex_cuadrado2[i] = x + (float)(mitad * Math.Sin(angulo1));
                verticey_cuadrado2[i] = y + (float)(mitad * Math.Cos(angulo1));
                angulo1 = angulo1 + ((float)Math.PI * 2 / 6);
            }

            // Calcular puntos de los hexágonos concéntricos
            for (int i = 0; i < 6; i++)
            {
                for (int l = 0; l < 5; l++)
                {
                    float angulo2 = (float)Math.PI + anguloRotacion;
                    float radio_actual = parte_mitad * (l + 1);

                    for (int j = 0; j < 6; j++)
                    {
                        puntasx_hexa[i, j, l] = verticex_cuadrado2[i] + (float)(radio_actual * Math.Sin(angulo2));
                        puntasy_hexa[i, j, l] = verticey_cuadrado2[i] + (float)(radio_actual * Math.Cos(angulo2));
                        angulo2 = angulo2 + ((float)Math.PI * 2 / 6);
                    }
                }
            }

            Pen lapiz = new Pen(Color.Black, 1);

            // Paso 0: Dibujar solo las líneas desde el centro
            if (pasoActual >= 1)
            {
                for (int j = 0; j < 6; j++)
                {
                    g.DrawLine(lapiz, x, y, verticex_cuadrado2[j], verticey_cuadrado2[j]);
                }
            }

            // Pasos 1-5: Dibujar los anillos concéntricos progresivamente
            if (pasoActual >= 2)
            {
                int maxAnillos = pasoActual - 1; // paso 2=1 anillo, paso 3=2 anillos, etc.
                if (pasoActual == 5) maxAnillos = 5; // Mostrar todos los anillos
                
                for (int i = 0; i < 6; i++)
                {
                    for (int l = 0; l < maxAnillos; l++)
                    {
                        for (int j = 0; j < 6; j++)
                        {
                            bool dibujar = false;

                            switch (i)
                            {
                                case 0:
                                    dibujar = (j == 3 || j == 4 || j == 5 || j == 0);
                                    break;
                                case 1:
                                    dibujar = (j == 4 || j == 5 || j == 0 || j == 1);
                                    break;
                                case 2:
                                    dibujar = (j == 5 || j == 0 || j == 1 || j == 2);
                                    break;
                                case 3:
                                    dibujar = (j == 0 || j == 1 || j == 2 || j == 3);
                                    break;
                                case 4:
                                    dibujar = (j == 1 || j == 2 || j == 3 || j == 4);
                                    break;
                                case 5:
                                    dibujar = (j == 2 || j == 3 || j == 4 || j == 5);
                                    break;
                            }

                            if (!dibujar)
                                continue;

                            int lado_siguiente = (j + 1) % 6;

                            g.DrawLine(lapiz,
                                puntasx_hexa[i, j, l], puntasy_hexa[i, j, l],
                                puntasx_hexa[i, lado_siguiente, l], puntasy_hexa[i, lado_siguiente, l]);
                        }
                    }
                }
            }

            lapiz.Dispose();
            g.Dispose();
            
            picCanvas.Image = canvas;
            picCanvas.Refresh();
        }

        private void grpBox_Enter(object sender, EventArgs e)
        {

        }

        private void label1_Click(object sender, EventArgs e)
        {

        }

        private void txtTamano_TextChanged(object sender, EventArgs e)
        {

        }
    }
}
