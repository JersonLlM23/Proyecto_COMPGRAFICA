using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace figura_5
{
    public partial class Form1 : Form
    {
        private float radio = 100;
        private float escala = 1.0f;
        private float anguloRotacion = 0;
        private float offsetX = 0;
        private float offsetY = 0;
        private int pasoActual = 0;
        private Bitmap bufferImagen;

        public Form1()
        {
            InitializeComponent();
            bufferImagen = new Bitmap(picCanvas.Width, picCanvas.Height);
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            txtRadio.Text = "100";
        }

        private void btnGraficar_Click(object sender, EventArgs e)
        {
            if (float.TryParse(txtRadio.Text, out float nuevoRadio))
            {
                radio = nuevoRadio;
                pasoActual = 7; // Mostrar todo
                DibujarFigura();
            }
            else
            {
                MessageBox.Show("Por favor ingresa un valor numérico válido.");
            }
        }

        private void btnResetear_Click(object sender, EventArgs e)
        {
            radio = 100;
            escala = 1.0f;
            anguloRotacion = 0;
            offsetX = 0;
            offsetY = 0;
            pasoActual = 0;
            trackBarEscala.Value = 100;
            txtRadio.Text = "100";
            
            // Limpiar el canvas
            Graphics g = Graphics.FromImage(bufferImagen);
            g.Clear(Color.White);
            picCanvas.Invalidate();
        }

        private void btnGiroAntihorario_Click(object sender, EventArgs e)
        {
            anguloRotacion -= 5 * (float)Math.PI / 180; // -5 grados a radianes
            DibujarFigura();
        }

        private void btnGiroHorario_Click(object sender, EventArgs e)
        {
            anguloRotacion += 5 * (float)Math.PI / 180; // +5 grados a radianes
            DibujarFigura();
        }

        private void trackBarEscala_Scroll(object sender, EventArgs e)
        {
            escala = trackBarEscala.Value / 100.0f;
            DibujarFigura();
        }

        private void btnAnterior_Click(object sender, EventArgs e)
        {
            if (pasoActual > 0)
            {
                pasoActual--;
                DibujarFigura();
            }
        }

        private void btnSiguiente_Click(object sender, EventArgs e)
        {
            if (pasoActual < 7)
            {
                pasoActual++;
                DibujarFigura();
            }
        }

        private void Form1_KeyDown(object sender, KeyEventArgs e)
        {
            float desplazamiento = 5;
            
            switch (e.KeyCode)
            {
                case Keys.Up:
                    offsetY -= desplazamiento;
                    break;
                case Keys.Down:
                    offsetY += desplazamiento;
                    break;
                case Keys.Left:
                    offsetX -= desplazamiento;
                    break;
                case Keys.Right:
                    offsetX += desplazamiento;
                    break;
            }
            
            DibujarFigura();
        }

        private void picCanvas_Paint(object sender, PaintEventArgs e)
        {
            if (bufferImagen != null)
            {
                e.Graphics.DrawImage(bufferImagen, 0, 0);
            }
        }

        private void DibujarFigura()
        {
            Graphics canvas = Graphics.FromImage(bufferImagen);
            canvas.Clear(Color.White);
            canvas.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;

            float radioEscalado = radio * escala;
            float radio2 = radioEscalado * 5 / 6;
            float radio3 = radioEscalado * 3 / 6;
            float radio4 = radioEscalado * 1 / 6;

            float ancho = picCanvas.Width;
            float alto = picCanvas.Height;

            float[] verticex_cuadrado1 = new float[4];
            float[] verticey_cuadrado1 = new float[4];
            float[] verticex_cuadrado2 = new float[4];
            float[] verticey_cuadrado2 = new float[4];

            float x = ancho / 2 + offsetX;
            float y = alto / 2 + offsetY;

            float angulo1 = (float)Math.PI + anguloRotacion;
            float angulo2 = (float)Math.PI + (float)Math.PI / 4 + anguloRotacion;

            for (int i = 0; i < 4; i++)
            {
                verticex_cuadrado1[i] = x + (float)(radioEscalado * Math.Sin(angulo1));
                verticey_cuadrado1[i] = y + (float)(radioEscalado * Math.Cos(angulo1));
                verticex_cuadrado2[i] = x + (float)(radioEscalado * Math.Sin(angulo2));
                verticey_cuadrado2[i] = y + (float)(radioEscalado * Math.Cos(angulo2));

                angulo1 = angulo1 + ((float)Math.PI / 2);
                angulo2 = angulo2 + ((float)Math.PI / 2);
            }

            Pen lapiz = new Pen(Color.Black, 2);
            Pen lapiz_entrecortado = new Pen(Color.Black, 1);
            lapiz_entrecortado.DashStyle = System.Drawing.Drawing2D.DashStyle.Dash;

            // Paso 0: Círculo exterior
            if (pasoActual >= 1)
            {
                canvas.DrawEllipse(lapiz_entrecortado, x - radioEscalado, y - radioEscalado, radioEscalado * 2, radioEscalado * 2);
            }

            // Paso 1: Segundo círculo
            if (pasoActual >= 2)
            {
                canvas.DrawEllipse(lapiz_entrecortado, x - radio2, y - radio2, radio2 * 2, radio2 * 2);
            }

            // Paso 2: Tercer círculo
            if (pasoActual >= 3)
            {
                canvas.DrawEllipse(lapiz_entrecortado, x - radio3, y - radio3, radio3 * 2, radio3 * 2);
            }

            // Paso 3: Círculo interior
            if (pasoActual >= 4)
            {
                canvas.DrawEllipse(lapiz_entrecortado, x - radio4, y - radio4, radio4 * 2, radio4 * 2);
            }

            // Paso 4: Primer cuadrado
            if (pasoActual >= 5)
            {
                for (int j = 0; j < 4; j++)
                {
                    canvas.DrawLine(lapiz, verticex_cuadrado1[j], verticey_cuadrado1[j], 
                                   verticex_cuadrado1[(j + 1) % 4], verticey_cuadrado1[(j + 1) % 4]);
                }
            }

            // Paso 5: Segundo cuadrado
            if (pasoActual >= 6)
            {
                for (int j = 0; j < 4; j++)
                {
                    canvas.DrawLine(lapiz, verticex_cuadrado2[j], verticey_cuadrado2[j], 
                                   verticex_cuadrado2[(j + 1) % 4], verticey_cuadrado2[(j + 1) % 4]);
                }
            }

            // Paso 6: Líneas radiales
            if (pasoActual >= 7)
            {
                for (int j = 0; j < 4; j++)
                {
                    canvas.DrawLine(lapiz_entrecortado, x, y, verticex_cuadrado1[j], verticey_cuadrado1[j]);
                    canvas.DrawLine(lapiz_entrecortado, x, y, verticex_cuadrado2[j], verticey_cuadrado2[j]);
                }

                // Líneas conectoras entre cuadrados
                for (int l = 0; l < 4; l++)
                {
                    canvas.DrawLine(lapiz, verticex_cuadrado1[l], verticey_cuadrado1[l], 
                                   verticex_cuadrado2[(l + 1) % 4], verticey_cuadrado2[(l + 1) % 4]);
                    canvas.DrawLine(lapiz, verticex_cuadrado1[l], verticey_cuadrado1[l], 
                                   verticex_cuadrado2[(l + 2) % 4], verticey_cuadrado2[(l + 2) % 4]);
                }
            }

            lapiz.Dispose();
            lapiz_entrecortado.Dispose();
            canvas.Dispose();

            picCanvas.Invalidate();
        }
    }
}